<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Internship Rotation Schedule</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .week-cell {
            width: 40px;
            height: 40px;
            text-align: center;
            border: 1px solid #ddd;
            font-size: 0.8rem;
        }
        .header-cell {
            background-color: #f0f0f0;
            font-weight: bold;
        }
        .batch-cell {
            background-color: #e0e0e0;
            font-weight: bold;
        }
        .medicine { background-color: #ffcccc; }
        .surgery { background-color: #ccffcc; }
        .obgy { background-color: #ccccff; }
        .community { background-color: #ffffcc; }
        .misc { background-color: #ffccff; }
        
        .highlight {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .legend-item {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .phase-header {
            font-weight: bold;
            background-color: #f0f0f0;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .schedule-container {
            overflow-x: auto;
            max-width: 100%;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 100;
            pointer-events: none;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-8">
    <div class="max-w-7xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold text-center mb-6">Medical Internship Rotation Schedule</h1>
        
        <div class="flex flex-col md:flex-row gap-4 mb-6">
            <div class="md:w-1/3">
                <label for="batch-select" class="block text-lg font-medium mb-2">Select Batch:</label>
                <select id="batch-select" class="w-full p-2 border rounded-md">
                    <option value="A">Batch A (M → S → O → C)</option>
                    <option value="B">Batch B (S → O → C → M)</option>
                    <option value="C">Batch C (O → C → M → S)</option>
                    <option value="D">Batch D (C → M → S → O)</option>
                </select>
            </div>
            
            <div class="md:w-1/3">
                <label for="week-select" class="block text-lg font-medium mb-2">Current Week:</label>
                <div class="flex items-center">
                    <button id="prev-week" class="px-4 py-2 bg-gray-200 rounded-l-md hover:bg-gray-300">&lt;</button>
                    <input type="number" id="week-select" min="1" max="52" value="1" class="w-full p-2 border text-center">
                    <button id="next-week" class="px-4 py-2 bg-gray-200 rounded-r-md hover:bg-gray-300">&gt;</button>
                </div>
            </div>

            <div class="md:w-1/3">
                <label for="phase-select" class="block text-lg font-medium mb-2">Jump to Phase:</label>
                <select id="phase-select" class="w-full p-2 border rounded-md">
                    <option value="1">Medicine (Weeks 1-12)</option>
                    <option value="13">Surgery (Weeks 13-24)</option>
                    <option value="25">OBGY (Weeks 25-36)</option>
                    <option value="37">Community Medicine (Weeks 37-48)</option>
                    <option value="49">Miscellaneous (Weeks 49-52)</option>
                </select>
            </div>
        </div>
        
        <div class="flex justify-center gap-4 mb-6">
            <button id="simulate-btn" class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Start Simulation</button>
            <button id="stop-simulation" class="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 hidden">Stop Simulation</button>
            <button id="reset-btn" class="px-6 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Reset</button>
        </div>

        <div class="mb-6 p-4 bg-blue-50 rounded-lg">
            <h2 class="text-xl font-bold mb-3">Current Status</h2>
            <div id="current-phase-info" class="text-lg mb-2">Phase: <span class="font-bold">Medicine (Week 1 of 12)</span></div>
            <div id="total-progress" class="text-lg">Overall Progress: <span class="font-bold">Week 1 of 52</span></div>
        </div>
        
        <div class="overflow-x-auto mb-8">
            <h2 class="text-xl font-bold mb-3">Current Week Schedule</h2>
            <table id="current-week-table" class="w-full border-collapse">
                <thead>
                    <tr>
                        <th class="border p-2 bg-gray-100">Subgroup</th>
                        <th class="border p-2 bg-gray-100">Current Posting</th>
                        <th class="border p-2 bg-gray-100">Department</th>
                        <th class="border p-2 bg-gray-100">Duration</th>
                        <th class="border p-2 bg-gray-100">Members</th>
                    </tr>
                </thead>
                <tbody id="current-week-body">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
        
        <div class="mb-8">
            <h2 class="text-xl font-bold mb-3">Full Schedule Overview</h2>
            <div class="flex mb-2">
                <button id="view-all" class="px-4 py-2 bg-blue-600 text-white rounded-l-md hover:bg-blue-700">View All Weeks</button>
                <button id="view-medicine" class="px-4 py-2 bg-red-200 text-gray-800 hover:bg-red-300">Medicine</button>
                <button id="view-surgery" class="px-4 py-2 bg-green-200 text-gray-800 hover:bg-green-300">Surgery</button>
                <button id="view-obgy" class="px-4 py-2 bg-blue-200 text-gray-800 hover:bg-blue-300">OBGY</button>
                <button id="view-community" class="px-4 py-2 bg-yellow-200 text-gray-800 hover:bg-yellow-300">Community</button>
                <button id="view-misc" class="px-4 py-2 bg-purple-200 text-gray-800 rounded-r-md hover:bg-purple-300">Misc</button>
            </div>
            <div class="schedule-container">
                <div class="flex mb-4 overflow-x-auto">
                    <div class="flex flex-col">
                        <div class="week-cell batch-cell">Week</div>
                        <div id="subgroups"></div>
                    </div>
                    <div id="schedule-grid" class="flex">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div id="tooltip" class="tooltip"></div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">Medicine (12 Weeks)</h3>
                <div class="legend-item medicine"></div> Medicine
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Code</th>
                        <th class="border p-1 text-sm">Subject</th>
                        <th class="border p-1 text-sm">Duration</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">GM</td>
                        <td class="border p-1 text-sm">General Medicine</td>
                        <td class="border p-1 text-sm">6 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">PY</td>
                        <td class="border p-1 text-sm">Psychiatry</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">CA</td>
                        <td class="border p-1 text-sm">Casualty</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">EN</td>
                        <td class="border p-1 text-sm">ENT</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                </table>
            </div>
            
            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">Surgery (12 Weeks)</h3>
                <div class="legend-item surgery"></div> Surgery
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Code</th>
                        <th class="border p-1 text-sm">Subject</th>
                        <th class="border p-1 text-sm">Duration</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">GS</td>
                        <td class="border p-1 text-sm">General Surgery</td>
                        <td class="border p-1 text-sm">6 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">AN</td>
                        <td class="border p-1 text-sm">Anaesthesia</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">OR</td>
                        <td class="border p-1 text-sm">Orthopedics</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">OP</td>
                        <td class="border p-1 text-sm">Ophthalmology</td>
                        <td class="border p-1 text-sm">2 weeks</td>
                    </tr>
                </table>
            </div>
            
            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">OBGY (12 Weeks)</h3>
                <div class="legend-item obgy"></div> OBGY
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Code</th>
                        <th class="border p-1 text-sm">Subject</th>
                        <th class="border p-1 text-sm">Duration</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">OB</td>
                        <td class="border p-1 text-sm">OBGY</td>
                        <td class="border p-1 text-sm">6 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">PE</td>
                        <td class="border p-1 text-sm">Paediatrics</td>
                        <td class="border p-1 text-sm">3 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">RM</td>
                        <td class="border p-1 text-sm">Respiratory Medicine</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">RA</td>
                        <td class="border p-1 text-sm">Radiology</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">DE</td>
                        <td class="border p-1 text-sm">Dermatology</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                </table>
            </div>
            
            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">Community Medicine (12 Weeks)</h3>
                <div class="legend-item community"></div> Community Medicine
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Code</th>
                        <th class="border p-1 text-sm">Subject</th>
                        <th class="border p-1 text-sm">Duration</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">CH</td>
                        <td class="border p-1 text-sm">CHC</td>
                        <td class="border p-1 text-sm">3 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">PH</td>
                        <td class="border p-1 text-sm">PHC</td>
                        <td class="border p-1 text-sm">3 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">UH</td>
                        <td class="border p-1 text-sm">UHC</td>
                        <td class="border p-1 text-sm">3 weeks</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">RH</td>
                        <td class="border p-1 text-sm">RHC</td>
                        <td class="border p-1 text-sm">3 weeks</td>
                    </tr>
                </table>
            </div>
            
            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">Miscellaneous (4 Weeks)</h3>
                <div class="legend-item misc"></div> Miscellaneous
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Code</th>
                        <th class="border p-1 text-sm">Subject</th>
                        <th class="border p-1 text-sm">Duration</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">GY</td>
                        <td class="border p-1 text-sm">Gynecology (separate)</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">LM</td>
                        <td class="border p-1 text-sm">Lab Medicine</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">FM</td>
                        <td class="border p-1 text-sm">Forensic Medicine</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">YO</td>
                        <td class="border p-1 text-sm">Yoga</td>
                        <td class="border p-1 text-sm">1 week</td>
                    </tr>
                </table>
            </div>

            <div class="border rounded-md p-4">
                <h3 class="text-lg font-bold mb-2">Batch Information</h3>
                <table class="w-full mt-2">
                    <tr>
                        <th class="border p-1 text-sm">Batch</th>
                        <th class="border p-1 text-sm">Rotation Sequence</th>
                        <th class="border p-1 text-sm">Members</th>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">A</td>
                        <td class="border p-1 text-sm">M → S → O → C → MIS</td>
                        <td class="border p-1 text-sm">34</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">B</td>
                        <td class="border p-1 text-sm">S → O → C → M → MIS</td>
                        <td class="border p-1 text-sm">34</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">C</td>
                        <td class="border p-1 text-sm">O → C → M → S → MIS</td>
                        <td class="border p-1 text-sm">34</td>
                    </tr>
                    <tr>
                        <td class="border p-1 text-sm">D</td>
                        <td class="border p-1 text-sm">C → M → S → O → MIS</td>
                        <td class="border p-1 text-sm">34</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Define the phase structure - this is the modular part that defines each phase
        const phaseStructure = {
            medicine: {
                name: "Medicine",
                duration: 12,
                class: "medicine",
                subphases: [
                    { code: "GM", name: "General Medicine", duration: 6 },
                    { code: "PY", name: "Psychiatry", duration: 2 },
                    { code: "CA", name: "Casualty", duration: 2 },
                    { code: "EN", name: "ENT", duration: 2 }
                ]
            },
            surgery: {
                name: "Surgery",
                duration: 12,
                class: "surgery",
                subphases: [
                    { code: "GS", name: "General Surgery", duration: 6 },
                    { code: "AN", name: "Anaesthesia", duration: 2 },
                    { code: "OR", name: "Orthopedics", duration: 2 },
                    { code: "OP", name: "Ophthalmology", duration: 2 }
                ]
            },
            obgy: {
                name: "OBGY",
                duration: 12,
                class: "obgy",
                subphases: [
                    { code: "OB", name: "OBGY", duration: 6 },
                    { code: "PE", name: "Paediatrics", duration: 3 },
                    { code: "RM", name: "Respiratory Medicine", duration: 1 },
                    { code: "RA", name: "Radiology", duration: 1 },
                    { code: "DE", name: "Dermatology", duration: 1 }
                ]
            },
            community: {
                name: "Community Medicine",
                duration: 12,
                class: "community",
                subphases: [
                    { code: "CH", name: "CHC", duration: 3 },
                    { code: "PH", name: "PHC", duration: 3 },
                    { code: "UH", name: "UHC", duration: 3 },
                    { code: "RH", name: "RHC", duration: 3 }
                ]
            },
            misc: {
                name: "Miscellaneous",
                duration: 4,
                class: "misc",
                subphases: [
                    { code: "GY", name: "Gynecology", duration: 1 },
                    { code: "LM", name: "Lab Medicine", duration: 1 },
                    { code: "FM", name: "Forensic Medicine", duration: 1 },
                    { code: "YO", name: "Yoga", duration: 1 }
                ]
            }
        };

        // Define the batch rotation sequences
        const batchSequences = {
            A: ["medicine", "surgery", "obgy", "community", "misc"],
            B: ["surgery", "obgy", "community", "medicine", "misc"],
            C: ["obgy", "community", "medicine", "surgery", "misc"],
            D: ["community", "medicine", "surgery", "obgy", "misc"]
        };

        // Function to get the phase for a given week and batch
        function getPhaseForWeek(week, batch) {
            const sequence = batchSequences[batch];
            
            if (week <= 12) {
                return sequence[0];
            } else if (week <= 24) {
                return sequence[1];
            } else if (week <= 36) {
                return sequence[2];
            } else if (week <= 48) {
                return sequence[3];
            } else {
                return sequence[4];
            }
        }

        // Function to get the relative week within a phase
        function getRelativeWeek(week) {
            if (week <= 12) {
                return week;
            } else if (week <= 24) {
                return week - 12;
            } else if (week <= 36) {
                return week - 24;
            } else if (week <= 48) {
                return week - 36;
            } else {
                return week - 48;
            }
        }

        // Function to get the posting for a given week, subgroup, and batch
        function getPostingForWeek(week, subgroup, batch) {
            const phase = getPhaseForWeek(week, batch);
            const relativeWeek = getRelativeWeek(week);
            const phaseInfo = phaseStructure[phase];
            
            // Get subgroup number (1-4)
            const subgroupNum = parseInt(subgroup.charAt(1));
            
            // Medicine Phase Logic
            if (phase === "medicine") {
                if (subgroupNum === 1) {
                    if (relativeWeek <= 6) {
                        return { code: "GM", phase, name: "General Medicine", duration: 6, weeks: [1, 2, 3, 4, 5, 6] };
                    } else if (relativeWeek <= 8) {
                        return { code: "PY", phase, name: "Psychiatry", duration: 2, weeks: [7, 8] };
                    } else if (relativeWeek <= 10) {
                        return { code: "CA", phase, name: "Casualty", duration: 2, weeks: [9, 10] };
                    } else {
                        return { code: "EN", phase, name: "ENT", duration: 2, weeks: [11, 12] };
                    }
                } else if (subgroupNum === 2) {
                    if (relativeWeek <= 2) {
                        return { code: "PY", phase, name: "Psychiatry", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "CA", phase, name: "Casualty", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "EN", phase, name: "ENT", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GM", phase, name: "General Medicine", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 3) {
                    if (relativeWeek <= 2) {
                        return { code: "CA", phase, name: "Casualty", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "EN", phase, name: "ENT", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "PY", phase, name: "Psychiatry", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GM", phase, name: "General Medicine", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 4) {
                    if (relativeWeek <= 2) {
                        return { code: "EN", phase, name: "ENT", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "PY", phase, name: "Psychiatry", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "CA", phase, name: "Casualty", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GM", phase, name: "General Medicine", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                }
            }
            
            // Surgery Phase Logic
            else if (phase === "surgery") {
                if (subgroupNum === 1) {
                    if (relativeWeek <= 6) {
                        return { code: "GS", phase, name: "General Surgery", duration: 6, weeks: [1, 2, 3, 4, 5, 6] };
                    } else if (relativeWeek <= 8) {
                        return { code: "AN", phase, name: "Anaesthesia", duration: 2, weeks: [7, 8] };
                    } else if (relativeWeek <= 10) {
                        return { code: "OR", phase, name: "Orthopedics", duration: 2, weeks: [9, 10] };
                    } else {
                        return { code: "OP", phase, name: "Ophthalmology", duration: 2, weeks: [11, 12] };
                    }
                } else if (subgroupNum === 2) {
                    if (relativeWeek <= 2) {
                        return { code: "AN", phase, name: "Anaesthesia", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "OR", phase, name: "Orthopedics", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "OP", phase, name: "Ophthalmology", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GS", phase, name: "General Surgery", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 3) {
                    if (relativeWeek <= 2) {
                        return { code: "OR", phase, name: "Orthopedics", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "OP", phase, name: "Ophthalmology", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "AN", phase, name: "Anaesthesia", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GS", phase, name: "General Surgery", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 4) {
                    if (relativeWeek <= 2) {
                        return { code: "OP", phase, name: "Ophthalmology", duration: 2, weeks: [1, 2] };
                    } else if (relativeWeek <= 4) {
                        return { code: "AN", phase, name: "Anaesthesia", duration: 2, weeks: [3, 4] };
                    } else if (relativeWeek <= 6) {
                        return { code: "OR", phase, name: "Orthopedics", duration: 2, weeks: [5, 6] };
                    } else {
                        return { code: "GS", phase, name: "General Surgery", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                }
            }
            
            // OBGY Phase Logic
            else if (phase === "obgy") {
                if (subgroupNum === 1) {
                    if (relativeWeek <= 6) {
                        return { code: "OB", phase, name: "OBGY", duration: 6, weeks: [1, 2, 3, 4, 5, 6] };
                    } else if (relativeWeek <= 9) {
                        return { code: "PE", phase, name: "Paediatrics", duration: 3, weeks: [7, 8, 9] };
                    } else if (relativeWeek <= 10) {
                        return { code: "RM", phase, name: "Respiratory Medicine", duration: 1, weeks: [10] };
                    } else if (relativeWeek <= 11) {
                        return { code: "RA", phase, name: "Radiology", duration: 1, weeks: [11] };
                    } else {
                        return { code: "DE", phase, name: "Dermatology", duration: 1, weeks: [12] };
                    }
                } else if (subgroupNum === 2) {
                    if (relativeWeek <= 3) {
                        return { code: "PE", phase, name: "Paediatrics", duration: 3, weeks: [1, 2, 3] };
                    } else if (relativeWeek <= 4) {
                        return { code: "RM", phase, name: "Respiratory Medicine", duration: 1, weeks: [4] };
                    } else if (relativeWeek <= 5) {
                        return { code: "RA", phase, name: "Radiology", duration: 1, weeks: [5] };
                    } else if (relativeWeek <= 6) {
                        return { code: "DE", phase, name: "Dermatology", duration: 1, weeks: [6] };
                    } else {
                        return { code: "OB", phase, name: "OBGY", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 3) {
                    if (relativeWeek <= 1) {
                        return { code: "RM", phase, name: "Respiratory Medicine", duration: 1, weeks: [1] };
                    } else if (relativeWeek <= 2) {
                        return { code: "RA", phase, name: "Radiology", duration: 1, weeks: [2] };
                    } else if (relativeWeek <= 3) {
                        return { code: "DE", phase, name: "Dermatology", duration: 1, weeks: [3] };
                    } else if (relativeWeek <= 6) {
                        return { code: "PE", phase, name: "Paediatrics", duration: 3, weeks: [4, 5, 6] };
                    } else {
                        return { code: "OB", phase, name: "OBGY", duration: 6, weeks: [7, 8, 9, 10, 11, 12] };
                    }
                } else if (subgroupNum === 4) {
                    if (relativeWeek <= 1) {
                        return { code: "DE", phase, name: "Dermatology", duration: 1, weeks: [1] };
                    } else if (relativeWeek <= 2) {
                        return { code: "RM", phase, name: "Respiratory Medicine", duration: 1, weeks: [2] };
                    } else if (relativeWeek <= 3) {
                        return { code: "RA", phase, name: "Radiology", duration: 1, weeks: [3] };
                    } else if (relativeWeek <= 9) {
                        return { code: "OB", phase, name: "OBGY", duration: 6, weeks: [4, 5, 6, 7, 8, 9] };
                    } else {
                        return { code: "PE", phase, name: "Paediatrics", duration: 3, weeks: [10, 11, 12] };
                    }
                }
            }
            
            // Community Medicine Phase Logic
            else if (phase === "community") {
                if (subgroupNum === 1) {
                    if (relativeWeek <= 3) {
                        return { code: "CH", phase, name: "CHC", duration: 3, weeks: [1, 2, 3] };
                    } else if (relativeWeek <= 6) {
                        return { code: "PH", phase, name: "PHC", duration: 3, weeks: [4, 5, 6] };
                    } else if (relativeWeek <= 9) {
                        return { code: "UH", phase, name: "UHC", duration: 3, weeks: [7, 8, 9] };
                    } else {
                        return { code: "RH", phase, name: "RHC", duration: 3, weeks: [10, 11, 12] };
                    }
                } else if (subgroupNum === 2) {
                    if (relativeWeek <= 3) {
                        return { code: "PH", phase, name: "PHC", duration: 3, weeks: [1, 2, 3] };
                    } else if (relativeWeek <= 6) {
                        return { code: "UH", phase, name: "UHC", duration: 3, weeks: [4, 5, 6] };
                    } else if (relativeWeek <= 9) {
                        return { code: "RH", phase, name: "RHC", duration: 3, weeks: [7, 8, 9] };
                    } else {
                        return { code: "CH", phase, name: "CHC", duration: 3, weeks: [10, 11, 12] };
                    }
                } else if (subgroupNum === 3) {
                    if (relativeWeek <= 3) {
                        return { code: "UH", phase, name: "UHC", duration: 3, weeks: [1, 2, 3] };
                    } else if (relativeWeek <= 6) {
                        return { code: "RH", phase, name: "RHC", duration: 3, weeks: [4, 5, 6] };
                    } else if (relativeWeek <= 9) {
                        return { code: "CH", phase, name: "CHC", duration: 3, weeks: [7, 8, 9] };
                    } else {
                        return { code: "PH", phase, name: "PHC", duration: 3, weeks: [10, 11, 12] };
                    }
                } else if (subgroupNum === 4) {
                    if (relativeWeek <= 3) {
                        return { code: "RH", phase, name: "RHC", duration: 3, weeks: [1, 2, 3] };
                    } else if (relativeWeek <= 6) {
                        return { code: "CH", phase, name: "CHC", duration: 3, weeks: [4, 5, 6] };
                    } else if (relativeWeek <= 9) {
                        return { code: "PH", phase, name: "PHC", duration: 3, weeks: [7, 8, 9] };
                    } else {
                        return { code: "UH", phase, name: "UHC", duration: 3, weeks: [10, 11, 12] };
                    }
                }
            }
            
            // Miscellaneous Phase Logic
            else if (phase === "misc") {
                if (subgroupNum === 1) {
                    if (relativeWeek === 1) {
                        return { code: "GY", phase, name: "Gynecology", duration: 1, weeks: [1] };
                    } else if (relativeWeek === 2) {
                        return { code: "LM", phase, name: "Lab Medicine", duration: 1, weeks: [2] };
                    } else if (relativeWeek === 3) {
                        return { code: "FM", phase, name: "Forensic Medicine", duration: 1, weeks: [3] };
                    } else {
                        return { code: "YO", phase, name: "Yoga", duration: 1, weeks: [4] };
                    }
                } else if (subgroupNum === 2) {
                    if (relativeWeek === 1) {
                        return { code: "LM", phase, name: "Lab Medicine", duration: 1, weeks: [1] };
                    } else if (relativeWeek === 2) {
                        return { code: "FM", phase, name: "Forensic Medicine", duration: 1, weeks: [2] };
                    } else if (relativeWeek === 3) {
                        return { code: "YO", phase, name: "Yoga", duration: 1, weeks: [3] };
                    } else {
                        return { code: "GY", phase, name: "Gynecology", duration: 1, weeks: [4] };
                    }
                } else if (subgroupNum === 3) {
                    if (relativeWeek === 1) {
                        return { code: "FM", phase, name: "Forensic Medicine", duration: 1, weeks: [1] };
                    } else if (relativeWeek === 2) {
                        return { code: "YO", phase, name: "Yoga", duration: 1, weeks: [2] };
                    } else if (relativeWeek === 3) {
                        return { code: "GY", phase, name: "Gynecology", duration: 1, weeks: [3] };
                    } else {
                        return { code: "LM", phase, name: "Lab Medicine", duration: 1, weeks: [4] };
                    }
                } else if (subgroupNum === 4) {
                    if (relativeWeek === 1) {
                        return { code: "YO", phase, name: "Yoga", duration: 1, weeks: [1] };
                    } else if (relativeWeek === 2) {
                        return { code: "GY", phase, name: "Gynecology", duration: 1, weeks: [2] };
                    } else if (relativeWeek === 3) {
                        return { code: "LM", phase, name: "Lab Medicine", duration: 1, weeks: [3] };
                    } else {
                        return { code: "FM", phase, name: "Forensic Medicine", duration: 1, weeks: [4] };
                    }
                }
            }
            
            return { code: "", phase: "", name: "", duration: 0, weeks: [] };
        }
        
        // Function to update the current week schedule
        function updateCurrentWeekSchedule() {
            const week = parseInt($("#week-select").val());
            const batch = $("#batch-select").val();
            
            const subgroups = [`${batch}1`, `${batch}2`, `${batch}3`, `${batch}4`];
            
            let html = "";
            
            for (const subgroup of subgroups) {
                const posting = getPostingForWeek(week, subgroup, batch);
                const phaseClass = posting.phase;
                
                html += `
                    <tr>
                        <td class="border p-2">${subgroup}</td>
                        <td class="border p-2 ${phaseClass}">${posting.code}</td>
                        <td class="border p-2">${posting.name}</td>
                        <td class="border p-2">${posting.duration} week${posting.duration > 1 ? 's' : ''}</td>
                        <td class="border p-2">${subgroup === batch + '1' ? '8' : subgroup === batch + '2' ? '9' : subgroup === batch + '3' ? '8' : '9'}</td>
                    </tr>
                `;
            }
            
            $("#current-week-body").html(html);
            
            // Update current phase info
            const phase = getPhaseForWeek(week, batch);
            const relativeWeek = getRelativeWeek(week);
            const phaseName = phaseStructure[phase].name;
            const phaseDuration = phaseStructure[phase].duration;
            
            $("#current-phase-info").html(`Phase: <span class="font-bold">${phaseName} (Week ${relativeWeek} of ${phaseDuration})</span>`);
            $("#total-progress").html(`Overall Progress: <span class="font-bold">Week ${week} of 52</span>`);
        }
        
        // Function to initialize the schedule grid
        function initializeScheduleGrid() {
            const batch = $("#batch-select").val();
            
            // Initialize subgroups
            let subgroupsHtml = "";
            for (let i = 1; i <= 4; i++) {
                subgroupsHtml += `<div class="week-cell batch-cell">${batch}${i}</div>`;
            }
            $("#subgroups").html(subgroupsHtml);
            
            // Initialize schedule grid
            let gridHtml = "";
            
            for (let week = 1; week <= 52; week++) {
                let columnHtml = `<div class="flex flex-col">
                    <div class="week-cell header-cell">${week}</div>`;
                
                for (let i = 1; i <= 4; i++) {
                    const subgroup = `${batch}${i}`;
                    const posting = getPostingForWeek(week, subgroup, batch);
                    const phaseClass = posting.phase;
                    
                    columnHtml += `<div class="week-cell ${phaseClass}" data-week="${week}" data-subgroup="${subgroup}" data-posting="${posting.code}" data-phase="${posting.phase}" data-name="${posting.name}">${posting.code}</div>`;
                }
                
                columnHtml += `</div>`;
                gridHtml += columnHtml;
            }
            
            $("#schedule-grid").html(gridHtml);
            
            // Highlight the current week
            highlightCurrentWeek();
            
            // Add tooltip functionality
            $(".week-cell").hover(
                function(e) {
                    const posting = $(this).data("posting");
                    const phase = $(this).data("phase");
                    const name = $(this).data("name");
                    const subgroup = $(this).data("subgroup");
                    const week = $(this).data("week");
                    
                    if (posting && phase && name) {
                        $("#tooltip").html(`
                            <div>Week: ${week}</div>
                            <div>Subgroup: ${subgroup}</div>
                            <div>Phase: ${phaseStructure[phase].name}</div>
                            <div>Posting: ${posting} - ${name}</div>
                        `);
                        
                        $("#tooltip").css({
                            top: e.pageY + 10,
                            left: e.pageX + 10,
                            display: "block"
                        });
                    }
                },
                function() {
                    $("#tooltip").css("display", "none");
                }
            );
            
            $(".week-cell").mousemove(function(e) {
                $("#tooltip").css({
                    top: e.pageY + 10,
                    left: e.pageX + 10
                });
            });
        }
        
        // Function to highlight the current week
        function highlightCurrentWeek() {
            const week = parseInt($("#week-select").val());
            
            // Remove highlight from all cells
            $(".week-cell").removeClass("highlight");
            
            // Add highlight to current week cells
            $(`.week-cell[data-week="${week}"]`).addClass("highlight");
        }
        
        // Function to filter the schedule grid by phase
        function filterScheduleByPhase(phase) {
            if (phase === "all") {
                $(".week-cell").show();
                return;
            }
            
            $(".week-cell").each(function() {
                const cellPhase = $(this).data("phase");
                if (cellPhase === phase || !cellPhase) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        }
        
        // Initialize the page
        $(document).ready(function() {
            // Initialize the schedule grid
            initializeScheduleGrid();
            
            // Initialize the current week schedule
            updateCurrentWeekSchedule();
            
            // Handle batch selection change
            $("#batch-select").change(function() {
                initializeScheduleGrid();
                updateCurrentWeekSchedule();
            });
            
            // Handle week selection change
            $("#week-select").change(function() {
                const week = parseInt($(this).val());
                
                // Validate week range
                if (week < 1) {
                    $(this).val(1);
                } else if (week > 52) {
                    $(this).val(52);
                }
                
                highlightCurrentWeek();
                updateCurrentWeekSchedule();
            });
            
            // Handle phase selection change
            $("#phase-select").change(function() {
                const week = parseInt($(this).val());
                $("#week-select").val(week).change();
            });
            
            // Handle previous week button
            $("#prev-week").click(function() {
                const week = parseInt($("#week-select").val());
                if (week > 1) {
                    $("#week-select").val(week - 1).change();
                }
            });
            
            // Handle next week button
            $("#next-week").click(function() {
                const week = parseInt($("#week-select").val());
                if (week < 52) {
                    $("#week-select").val(week + 1).change();
                }
            });
            
            // Handle reset button
            $("#reset-btn").click(function() {
                $("#week-select").val(1).change();
                $("#batch-select").val("A").change();
                stopSimulation();
                filterScheduleByPhase("all");
                $("#view-all").addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-medicine, #view-surgery, #view-obgy, #view-community, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            // Handle phase filter buttons
            $("#view-all").click(function() {
                filterScheduleByPhase("all");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-medicine, #view-surgery, #view-obgy, #view-community, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            $("#view-medicine").click(function() {
                filterScheduleByPhase("medicine");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-all, #view-surgery, #view-obgy, #view-community, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            $("#view-surgery").click(function() {
                filterScheduleByPhase("surgery");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-all, #view-medicine, #view-obgy, #view-community, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            $("#view-obgy").click(function() {
                filterScheduleByPhase("obgy");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-all, #view-medicine, #view-surgery, #view-community, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            $("#view-community").click(function() {
                filterScheduleByPhase("community");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-all, #view-medicine, #view-surgery, #view-obgy, #view-misc").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            $("#view-misc").click(function() {
                filterScheduleByPhase("misc");
                $(this).addClass("bg-blue-600 text-white").removeClass("bg-gray-200 text-gray-800");
                $("#view-all, #view-medicine, #view-surgery, #view-obgy, #view-community").removeClass("bg-blue-600 text-white").addClass("bg-gray-200 text-gray-800");
            });
            
            // Simulation variables
            let simulationInterval = null;
            
            // Handle simulation button
            $("#simulate-btn").click(function() {
                if (!simulationInterval) {
                    startSimulation();
                }
            });
            
            // Handle stop simulation button
            $("#stop-simulation").click(function() {
                stopSimulation();
            });
            
            // Function to start simulation
            function startSimulation() {
                $("#simulate-btn").hide();
                $("#stop-simulation").show();
                
                simulationInterval = setInterval(function() {
                    const week = parseInt($("#week-select").val());
                    if (week < 52) {
                        $("#week-select").val(week + 1).change();
                    } else {
                        stopSimulation();
                    }
                }, 1000);
            }
            
            // Function to stop simulation
            function stopSimulation() {
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                }
                
                $("#simulate-btn").show();
                $("#stop-simulation").hide();
            }
        });
    </script>
</body>
</html>